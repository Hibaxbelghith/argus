<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau de bord - Argus Security</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      min-height: 100vh;
      padding-bottom: 40px;
    }
    
    .navbar-custom {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      border-radius: 15px;
      margin: 20px auto 30px;
      padding: 15px 20px;
      max-width: 1400px;
      animation: fadeInUp 0.5s ease-out;
    }
    
    .navbar-custom .navbar-brand {
      color: #667eea;
      font-weight: bold;
      font-size: 1.3rem;
      transition: transform 0.3s ease;
    }
    
    .navbar-custom .navbar-brand:hover {
      transform: scale(1.05);
    }
    
    .navbar-custom .btn-light {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-left: 10px;
    }
    
    .navbar-custom .btn-light:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .welcome-section {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.6s ease-out 0.2s backwards;
    }
    
    .welcome-section h2 {
      color: white;
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .welcome-section p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.2rem;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.6s ease-out backwards;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
    }
    
    .card-title {
      color: #667eea;
      font-weight: bold;
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    
    .btn-outline-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-outline-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .btn-outline-primary:hover::before {
      left: 100%;
    }
    
    .btn-outline-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      color: white;
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    
    .btn-outline-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      border: none;
      transition: all 0.3s ease;
    }
    
    .btn-outline-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
      color: white;
    }
    
    /* Statistics Cards */
    .bg-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
    
    .bg-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important;
    }
    
    .bg-warning {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    }
    
    .bg-info {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
    }
    
    /* Section Headers */
    h4 {
      color: white;
      font-weight: bold;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    /* Staggered animations */
    .col-md-4:nth-child(1) .card { animation-delay: 0.1s; }
    .col-md-4:nth-child(2) .card { animation-delay: 0.15s; }
    .col-md-4:nth-child(3) .card { animation-delay: 0.2s; }
    .col-md-4:nth-child(4) .card { animation-delay: 0.25s; }
    .col-md-4:nth-child(5) .card { animation-delay: 0.3s; }
    .col-md-4:nth-child(6) .card { animation-delay: 0.35s; }
    .col-md-4:nth-child(7) .card { animation-delay: 0.4s; }
    .col-md-4:nth-child(8) .card { animation-delay: 0.45s; }
    .col-md-4:nth-child(9) .card { animation-delay: 0.5s; }
    .col-md-4:nth-child(10) .card { animation-delay: 0.55s; }
    
    .col-md-3:nth-child(1) .card { animation-delay: 0.1s; }
    .col-md-3:nth-child(2) .card { animation-delay: 0.2s; }
    .col-md-3:nth-child(3) .card { animation-delay: 0.3s; }
    .col-md-3:nth-child(4) .card { animation-delay: 0.4s; }
    
    /* AI Insights Cards */
    .insights-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    /* Progress bars */
    .progress {
      background: rgba(102, 126, 234, 0.1);
      border-radius: 10px;
    }
    
    .progress-bar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
    }
    
    /* Badges */
    .badge {
      padding: 5px 12px;
      border-radius: 10px;
      font-weight: 600;
    }
    
    /* Alerts */
    .alert {
      border: none;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* Spinner */
    .spinner-border {
      border-color: #667eea;
      border-right-color: transparent;
    }
    
    @media (max-width: 768px) {
      .welcome-section h2 {
        font-size: 2rem;
      }
      
      .card {
        margin-bottom: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="bi bi-shield-shaded"></i> Argus Security
        </a>
        <div class="d-flex align-items-center">
          <a href="{% url 'profile' %}" class="btn btn-light btn-sm">
            <i class="bi bi-person-circle"></i> My Profile
          </a>
          <a href="{% url 'logout' %}" class="btn btn-light btn-sm">
            <i class="bi bi-box-arrow-right"></i> D√©connexion
          </a>
        </div>
      </div>
    </nav>
  </div>

    <!-- Contenu principal -->
    <div class="container dashboard-container">
      <div class="welcome-section">
        <h2>Bienvenue, {{ request.user.username }} üëã</h2>
        <p>
          Heureux de vous revoir ! Voici votre espace de gestion et de s√©curit√©.
        </p>
      </div>

      <div class="row g-4">
        <!-- Bloc 1 -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üì∑ Cam√©ra</h5>
            <p>
              Visualisez le flux en direct et configurez la surveillance
              intelligente.
            </p>
            <a href="#" class="btn btn-outline-primary">Ouvrir</a>
          </div>
        </div>

        <!-- Bloc 2 -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">ü§ñ D√©tection IA</h5>
            <p>Activez l‚Äôanalyse automatique et la reconnaissance faciale.</p>
            <a href="#" class="btn btn-outline-primary">Configurer</a>
          </div>
        </div>

        <!-- Bloc 3 -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">‚ö†Ô∏è Alertes</h5>
            <p>
              Consultez les alertes g√©n√©r√©es et l‚Äôhistorique des √©v√©nements.
            </p>
            <a href="#" class="btn btn-outline-primary">Voir</a>
          </div>
        </div>

        <!-- Bloc 4 : Voice Control -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üé§ Commandes vocales</h5>
            <p>
              Testez et g√©rez les commandes vocales pour contr√¥ler la s√©curit√©
              et l‚Äôacc√®s.
            </p>
            {% if request.user.is_staff %}
            <a
              href="/admin/voicecontrol/voicecommand/"
              class="btn btn-outline-primary"
              >G√©rer les commandes (CRUD)</a
            >
            {% else %}
            <a href="{% url 'voice_demo' %}" class="btn btn-outline-primary"
              >Acc√©der au module</a
            >
            {% endif %}
          </div>
        </div>

        <!-- Bloc 5 -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üéØ D√©tection objets</h5>
            <p>
              Analyse en temps r√©el du flux vid√©o pour d√©tecter personnes et
              objets automatiquement.
            </p>
            <a href="/detection/" class="btn btn-outline-primary">Ouvrir</a>
          </div>
        </div>

        <!-- Bloc 6 : Live Emotion Detection -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üòä D√©tection d'√©motions</h5>
            <p>
              D√©tectez les √©motions en temps r√©el via votre webcam avec
              affichage des r√©sultats en direct.
            </p>
            <a href="/emotion/live/" class="btn btn-outline-primary"
              >Lancer le module</a
            >
          </div>
        </div>

        <!-- Bloc 7 : Mouvement Detection -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üö∂ D√©tection de Mouvement</h5>
            <p>
              D√©tection intelligente de mouvement avec capture d'images et
              historique des √©v√©nements.
            </p>
            <div class="d-flex gap-2">
              <a href="/mouvment/" class="btn btn-outline-primary btn-sm"
                >Flux en Direct</a
              >
              <a href="/mouvment/events/" class="btn btn-outline-success btn-sm"
                >Historique</a
              >
            </div>
          </div>
        </div>

        <!-- Bloc 8 : Analytics AI -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">ü§ñ Analytics AI</h5>
            <p>
              Analyses intelligentes avec pr√©dictions ML, scoring de s√©curit√© et
              recommandations IA.
            </p>
            <div class="d-flex gap-2">
              <a
                href="{% url 'analytics:dashboard' %}"
                class="btn btn-outline-primary btn-sm"
                >Dashboard</a
              >
              <a
                href="{% url 'analytics:ai_report' %}"
                class="btn btn-outline-success btn-sm"
                >Rapport IA</a
              >
            </div>
          </div>
        </div>

        <!-- Bloc 9 : Notifications -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üîî Notifications</h5>
            <p>
              G√©rez vos notifications, alertes pr√©dictives et pr√©f√©rences de
              communication.
            </p>
            <a
              href="{% url 'notifications:dashboard' %}"
              class="btn btn-outline-primary"
              >Centre de notifications</a
            >
          </div>
        </div>

        <!-- Bloc 10 : Historique D√©tections -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">üìú Historique</h5>
            <p>
              Consultez l'historique complet de toutes vos d√©tections et
              analyses.
            </p>
            <a
              href="{% url 'detection:history' %}"
              class="btn btn-outline-primary"
              >Voir l'historique</a
            >
          </div>
        </div>
      </div>

      <!-- Section des statistiques rapides -->
      <div class="row g-4 mt-4">
        <div class="col-12">
          <h4 class="text-center mb-3">üìà Statistiques en Temps R√©el</h4>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-primary text-white">
            <h6>Total D√©tections</h6>
            <h2 id="total-detections">--</h2>
            <small>Depuis le d√©but</small>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-success text-white">
            <h6>Objets D√©tect√©s</h6>
            <h2 id="total-objects">--</h2>
            <small>Aujourd'hui</small>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-warning text-white">
            <h6>Alertes Actives</h6>
            <h2 id="active-alerts">--</h2>
            <small>Non r√©solues</small>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-info text-white">
            <h6>Notifications</h6>
            <h2 id="unread-notifications">--</h2>
            <small>Non lues</small>
          </div>
        </div>
      </div>

      <!-- Section AI Insights -->
      <div class="row g-4 mt-4">
        <div class="col-12">
          <h4 class="text-center mb-3">ü§ñ Insights IA du Jour</h4>
        </div>

        <div class="col-md-4">
          <div class="card p-3">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <div
                  style="
                    width: 60px;
                    height: 60px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  "
                >
                  <h4 class="text-white mb-0" id="security-score">--</h4>
                </div>
              </div>
              <div>
                <h6 class="mb-1">Score de S√©curit√©</h6>
                <p class="text-muted mb-0 small">Analyse AI de votre syst√®me</p>
                <span class="badge bg-success" id="security-level"
                  >Chargement...</span
                >
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card p-3">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i
                  class="bi bi-graph-up-arrow"
                  style="font-size: 2.5rem; color: #0d6efd"
                ></i>
              </div>
              <div>
                <h6 class="mb-1">Tendance du Jour</h6>
                <p class="mb-0"><strong id="trend-direction">--</strong></p>
                <small class="text-muted" id="trend-details"
                  >Analyse en cours...</small
                >
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card p-3">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i
                  class="bi bi-exclamation-triangle-fill"
                  style="font-size: 2.5rem; color: #ffc107"
                ></i>
              </div>
              <div>
                <h6 class="mb-1">Objets Suspects</h6>
                <h4 class="mb-0" id="suspicious-count">--</h4>
                <small class="text-muted">Confiance < 50%</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section Top Objets -->
      <div class="row g-4 mt-4">
        <div class="col-md-6">
          <div class="card p-3">
            <h5 class="card-title mb-3">
              üéØ Top 5 Objets D√©tect√©s Aujourd'hui
            </h5>
            <div id="top-objects-list">
              <div class="text-center text-muted">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="mt-2">Chargement des donn√©es...</p>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card p-3">
            <h5 class="card-title mb-3">üí° Recommandation IA</h5>
            <div id="ai-recommendation">
              <div class="text-center text-muted">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="mt-2">Analyse en cours...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Charger les statistiques au chargement de la page
      document.addEventListener("DOMContentLoaded", function () {
        loadStats();
        loadAIInsights();
        // Rafra√Æchir toutes les 30 secondes
        setInterval(loadStats, 30000);
        setInterval(loadAIInsights, 60000); // AI insights toutes les 60 secondes
      });

      async function loadStats() {
        try {
          // Statistiques Analytics
          const analyticsResponse = await fetch(
            "/analytics/api/stats/summary/"
          );
          if (analyticsResponse.ok) {
            const analyticsData = await analyticsResponse.json();
            document.getElementById("total-detections").textContent =
              analyticsData.data.total_detections || 0;
            document.getElementById("total-objects").textContent =
              analyticsData.data.total_objects_detected || 0;
            document.getElementById("active-alerts").textContent =
              analyticsData.data.alerts.unread || 0;
          }

          // Statistiques Notifications
          const notifResponse = await fetch("/notifications/api/stats/");
          if (notifResponse.ok) {
            const notifData = await notifResponse.json();
            document.getElementById("unread-notifications").textContent =
              notifData.data.unread_count || 0;
          }
        } catch (error) {
          console.log("Erreur lors du chargement des statistiques:", error);
          // Afficher 0 en cas d'erreur
          document.getElementById("total-detections").textContent = "0";
          document.getElementById("total-objects").textContent = "0";
          document.getElementById("active-alerts").textContent = "0";
          document.getElementById("unread-notifications").textContent = "0";
        }
      }

      async function loadAIInsights() {
        try {
          // Utiliser le nouvel endpoint optimis√© pour les insights rapides
          const response = await fetch(
            "/analytics/api/quick-insights/?period=day"
          );
          if (response.ok) {
            const result = await response.json();

            if (result.success) {
              const insights = result.data;

              // Score de s√©curit√©
              const securityScore = insights.security.score || 0;
              const securityLevel = insights.security.level || "unknown";
              document.getElementById("security-score").textContent =
                securityScore;

              const levelBadge = document.getElementById("security-level");
              levelBadge.textContent = securityLevel.toUpperCase();

              // Couleur du badge selon le niveau
              levelBadge.className = "badge ";
              if (securityLevel === "excellent")
                levelBadge.className += "bg-success";
              else if (securityLevel === "good")
                levelBadge.className += "bg-primary";
              else if (securityLevel === "moderate")
                levelBadge.className += "bg-warning";
              else levelBadge.className += "bg-danger";

              // Tendance
              const trend = insights.summary.trend || "stable";
              const changePercent = insights.summary.change_percent || 0;
              document.getElementById("trend-direction").textContent =
                trend === "increasing"
                  ? "üìà En hausse"
                  : trend === "decreasing"
                  ? "üìâ En baisse"
                  : "‚û°Ô∏è Stable";
              document.getElementById("trend-details").textContent = `${
                changePercent > 0 ? "+" : ""
              }${changePercent.toFixed(1)}% vs hier`;

              // Objets suspects
              document.getElementById("suspicious-count").textContent =
                insights.summary.suspicious_count || 0;

              // Top objets
              const topObjects = insights.top_objects || [];
              let topObjectsHtml = "";
              if (topObjects.length === 0) {
                topObjectsHtml =
                  '<p class="text-muted">Aucune d√©tection aujourd\'hui</p>';
              } else {
                topObjects.forEach((obj, index) => {
                  topObjectsHtml += `
                  <div class="d-flex align-items-center mb-2 pb-2 border-bottom">
                    <span class="badge bg-primary me-2">${index + 1}</span>
                    <div class="flex-grow-1">
                      <strong>${obj.object_type}</strong>
                      <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-success" style="width: ${
                          obj.avg_confidence
                        }%"></div>
                      </div>
                    </div>
                    <span class="badge bg-light text-dark ms-2">${
                      obj.count
                    }</span>
                  </div>
                `;
                });
              }
              document.getElementById("top-objects-list").innerHTML =
                topObjectsHtml;

              // Recommandation IA
              const topRec = insights.top_recommendation;
              let recHtml = "";
              if (!topRec) {
                recHtml =
                  '<p class="text-muted">Aucune recommandation pour le moment</p>';
              } else {
                const priorityColor =
                  topRec.priority === "high"
                    ? "danger"
                    : topRec.priority === "medium"
                    ? "warning"
                    : "info";

                recHtml = `
                <div class="alert alert-${priorityColor} mb-0">
                  <h6 class="alert-heading"><i class="bi bi-lightbulb-fill me-2"></i>${
                    topRec.title
                  }</h6>
                  <ul class="mb-0">
                    ${topRec.actions
                      .slice(0, 3)
                      .map((action) => `<li>${action}</li>`)
                      .join("")}
                  </ul>
                  <div class="mt-2">
                    <a href="/analytics/ai-report/" class="btn btn-sm btn-outline-${priorityColor}">
                      Voir toutes les recommandations ‚Üí
                    </a>
                  </div>
                </div>
              `;
              }
              document.getElementById("ai-recommendation").innerHTML = recHtml;
            } else {
              showDefaultInsights();
            }
          } else {
            showDefaultInsights();
          }
        } catch (error) {
          console.log("Erreur lors du chargement des insights AI:", error);
          showDefaultInsights();
        }
      }

      function showDefaultInsights() {
        // Afficher des valeurs par d√©faut en cas d'erreur
        document.getElementById("security-score").textContent = "--";
        document.getElementById("security-level").textContent = "N/A";
        document.getElementById("trend-direction").textContent = "--";
        document.getElementById("trend-details").textContent =
          "Donn√©es insuffisantes";
        document.getElementById("suspicious-count").textContent = "0";
        document.getElementById("top-objects-list").innerHTML =
          '<p class="text-muted">Effectuez des d√©tections pour voir les statistiques</p>';
        document.getElementById("ai-recommendation").innerHTML =
          '<p class="text-muted">Les recommandations IA appara√Ætront apr√®s vos premi√®res d√©tections</p>';
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
