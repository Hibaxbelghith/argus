<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Argus Security</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    @keyframes shimmer {
      0% {
        background-position: -1000px 0;
      }
      100% {
        background-position: 1000px 0;
      }
    }
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      min-height: 100vh;
      padding-bottom: 40px;
    }
    
    .navbar-custom {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      border-radius: 15px;
      margin: 20px auto 30px;
      padding: 15px 20px;
      max-width: 1400px;
      animation: fadeInUp 0.5s ease-out;
    }
    
    .navbar-custom .navbar-brand {
      color: #667eea;
      font-weight: bold;
      font-size: 1.3rem;
      transition: transform 0.3s ease;
    }
    
    .navbar-custom .navbar-brand:hover {
      transform: scale(1.05);
    }
    
    .navbar-custom .btn-light {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-left: 10px;
    }
    
    .navbar-custom .btn-light:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .welcome-section {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.6s ease-out 0.2s backwards;
    }
    
    .welcome-section h2 {
      color: white;
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .welcome-section p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.2rem;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.6s ease-out backwards;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
    }
    
    .card-title {
      color: #667eea;
      font-weight: bold;
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    
    .btn-outline-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 25px;
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-outline-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .btn-outline-primary:hover::before {
      left: 100%;
    }
    
    .btn-outline-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      color: white;
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    
    .btn-outline-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      border: none;
      transition: all 0.3s ease;
    }
    
    .btn-outline-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
      color: white;
    }
    
    /* Statistics Cards */
    .bg-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
    
    .bg-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important;
    }
    
    .bg-warning {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    }
    
    .bg-info {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
    }
    
    /* Section Headers */
    h4 {
      color: white;
      font-weight: bold;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    /* Staggered animations */
    .col-md-4:nth-child(1) .card { animation-delay: 0.1s; }
    .col-md-4:nth-child(2) .card { animation-delay: 0.15s; }
    .col-md-4:nth-child(3) .card { animation-delay: 0.2s; }
    .col-md-4:nth-child(4) .card { animation-delay: 0.25s; }
    .col-md-4:nth-child(5) .card { animation-delay: 0.3s; }
    .col-md-4:nth-child(6) .card { animation-delay: 0.35s; }
    .col-md-4:nth-child(7) .card { animation-delay: 0.4s; }
    .col-md-4:nth-child(8) .card { animation-delay: 0.45s; }
    .col-md-4:nth-child(9) .card { animation-delay: 0.5s; }
    .col-md-4:nth-child(10) .card { animation-delay: 0.55s; }
    
    .col-md-3:nth-child(1) .card { animation-delay: 0.1s; }
    .col-md-3:nth-child(2) .card { animation-delay: 0.2s; }
    .col-md-3:nth-child(3) .card { animation-delay: 0.3s; }
    .col-md-3:nth-child(4) .card { animation-delay: 0.4s; }
    
    /* AI Insights Cards */
    .insights-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    /* Progress bars */
    .progress {
      background: rgba(102, 126, 234, 0.1);
      border-radius: 10px;
    }
    
    .progress-bar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
    }
    
    /* Badges */
    .badge {
      padding: 5px 12px;
      border-radius: 10px;
      font-weight: 600;
    }
    
    /* Alerts */
    .alert {
      border: none;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* Spinner */
    .spinner-border {
      border-color: #667eea;
      border-right-color: transparent;
    }
    
    @media (max-width: 768px) {
      .welcome-section h2 {
        font-size: 2rem;
      }
      
      .card {
        margin-bottom: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="bi bi-shield-shaded"></i> Argus Security
        </a>
        <div class="d-flex align-items-center">
          <a href="{% url 'profile' %}" class="btn btn-light btn-sm">
            <i class="bi bi-person-circle"></i> My Profile
          </a>
          <a href="{% url 'logout' %}" class="btn btn-light btn-sm">
            <i class="bi bi-box-arrow-right"></i> Logout
          </a>
        </div>
      </div>
    </nav>
  </div>

    <!-- Main Content -->
    <div class="container dashboard-container">
      <div class="welcome-section">
        <h2>Welcome Back, {{ request.user.username }} 👋</h2>
        <p>
          Great to see you again! Here's your security management center.
        </p>
      </div>

      <div class="row g-4">

        <!-- Block 4 : Voice Control -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">🎤 Voice Commands</h5>
            <p>
              Test and manage Voice Commands to control security
              and access.
            </p>
            {% if request.user.is_staff %}
            <a
              href="/admin/voicecontrol/voicecommand/"
              class="btn btn-outline-primary"
              >Manage Commands (CRUD)</a
            >
            {% else %}
            <a href="{% url 'voice_demo' %}" class="btn btn-outline-primary"
              >Access Module</a
            >
            {% endif %}
          </div>
        </div>

        <!-- Block 5 -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">🎯 Object Detection</h5>
            <p>
              Real-time video analysis to automatically detect people and objects.
            </p>
            <a href="/detection/" class="btn btn-outline-primary">Open</a>
          </div>
        </div>

        <!-- Block 6 : Live Emotion Detection -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">😊 Emotion Detection</h5>
            <p>
              Detect emotions in real-time via your webcam with live results display.
            </p>
            <a href="/emotion/live/" class="btn btn-outline-primary"
              >Launch Module</a
            >
          </div>
        </div>

        <!-- Block 7 : Mouvement Detection -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">🚶 Motion Detection</h5>
            <p>
              Intelligent motion detection with image capture and event history.
            </p>
            <div class="d-flex gap-2">
              <a href="/mouvment/" class="btn btn-outline-primary btn-sm"
                >Live Stream</a
              >
              <a href="/mouvment/events/" class="btn btn-outline-success btn-sm"
                >History</a
              >
            </div>
          </div>
        </div>

        <!-- Block 8 : AI Analytics -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">🤖 AI Analytics</h5>
            <p>
              Intelligent analytics with ML predictions, security scoring and AI recommendations.
            </p>
            <div class="d-flex gap-2">
              <a
                href="{% url 'analytics:dashboard' %}"
                class="btn btn-outline-primary btn-sm"
                >Dashboard</a
              >
              <a
                href="{% url 'analytics:ai_report' %}"
                class="btn btn-outline-success btn-sm"
                >AI Report</a
              >
            </div>
          </div>
        </div>

        <!-- Block 9 : Notifications -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">🔔 Notifications</h5>
            <p>
              Manage your notifications, predictive alerts and communication
              preferences.
            </p>
            <a
              href="{% url 'notifications:dashboard' %}"
              class="btn btn-outline-primary"
              >Notification Center</a
            >
          </div>
        </div>

        <!-- Block 10 : Detection History -->
        <div class="col-md-4">
          <div class="card p-3">
            <h5 class="card-title">📜 History</h5>
            <p>
              View complete history of all your detections and analyses.
            </p>
            <a
              href="{% url 'detection:history' %}"
              class="btn btn-outline-primary"
              >View History</a
            >
          </div>
        </div>
      </div>

      <!-- Quick Statistics Section -->
      <div class="row g-4 mt-4">
        <div class="col-12">
          <h4 class="text-center mb-3">📈 Real-Time Statistics</h4>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-primary text-white">
            <h6>Total Detections</h6>
            <h2 id="total-detections">--</h2>
            <small>Since beginning</small>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-success text-white">
            <h6>Detected Objects</h6>
            <h2 id="total-objects">--</h2>
            <small>Today</small>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-warning text-white">
            <h6>Alerts Actives</h6>
            <h2 id="active-alerts">--</h2>
            <small>Unresolved</small>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card p-3 text-center bg-info text-white">
            <h6>Notifications</h6>
            <h2 id="unread-notifications">--</h2>
            <small>Unread</small>
          </div>
        </div>
      </div>

      <!-- AI Insights Section -->
      <div class="row g-4 mt-4">
        <div class="col-12">
          <h4 class="text-center mb-3">🤖 AI Insights of the Day</h4>
        </div>

        <div class="col-md-4">
          <div class="card p-3">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <div
                  style="
                    width: 60px;
                    height: 60px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  "
                >
                  <h4 class="text-white mb-0" id="security-score">--</h4>
                </div>
              </div>
              <div>
                <h6 class="mb-1">Security Score</h6>
                <p class="text-muted mb-0 small">AI Analysis of your system</p>
                <span class="badge bg-success" id="security-level"
                  >Loading...</span
                >
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card p-3">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i
                  class="bi bi-graph-up-arrow"
                  style="font-size: 2.5rem; color: #0d6efd"
                ></i>
              </div>
              <div>
                <h6 class="mb-1">Daily Trend</h6>
                <p class="mb-0"><strong id="trend-direction">--</strong></p>
                <small class="text-muted" id="trend-details"
                  >Analysis in progress...</small
                >
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card p-3">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i
                  class="bi bi-exclamation-triangle-fill"
                  style="font-size: 2.5rem; color: #ffc107"
                ></i>
              </div>
              <div>
                <h6 class="mb-1">Suspicious Objects</h6>
                <h4 class="mb-0" id="suspicious-count">--</h4>
                <small class="text-muted">Confidence < 50%</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Objects Section -->
      <div class="row g-4 mt-4">
        <div class="col-md-6">
          <div class="card p-3">
            <h5 class="card-title mb-3">
              🎯 Top 5 Detected Objects Today
            </h5>
            <div id="top-objects-list">
              <div class="text-center text-muted">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading data...</p>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card p-3">
            <h5 class="card-title mb-3">💡 AI Recommendation</h5>
            <div id="ai-recommendation">
              <div class="text-center text-muted">
                <div class="spinner-border spinner-border-sm" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Analysis in progress...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Load statistics on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadStats();
        loadAIInsights();
        // Refresh every 30 seconds
        setInterval(loadStats, 30000);
        setInterval(loadAIInsights, 60000); // AI insights every 60 seconds
      });

      async function loadStats() {
        try {
          // Analytics Statistics
          const analyticsResponse = await fetch(
            "/analytics/api/stats/summary/"
          );
          if (analyticsResponse.ok) {
            const analyticsData = await analyticsResponse.json();
            document.getElementById("total-detections").textContent =
              analyticsData.data.total_detections || 0;
            document.getElementById("total-objects").textContent =
              analyticsData.data.total_objects_detected || 0;
            document.getElementById("active-alerts").textContent =
              analyticsData.data.alerts.unread || 0;
          }

          // Notifications Statistics
          const notifResponse = await fetch("/notifications/api/stats/");
          if (notifResponse.ok) {
            const notifData = await notifResponse.json();
            document.getElementById("unread-notifications").textContent =
              notifData.data.unread_count || 0;
          }
        } catch (error) {
          console.log("Error loading statistics:", error);
          // Display 0 in case of error
          document.getElementById("total-detections").textContent = "0";
          document.getElementById("total-objects").textContent = "0";
          document.getElementById("active-alerts").textContent = "0";
          document.getElementById("unread-notifications").textContent = "0";
        }
      }

      async function loadAIInsights() {
        try {
          // Use the optimized endpoint for quick insights
          const response = await fetch(
            "/analytics/api/quick-insights/?period=day"
          );
          if (response.ok) {
            const result = await response.json();

            if (result.success) {
              const insights = result.data;

              // Security score
              const securityScore = insights.security.score || 0;
              const securityLevel = insights.security.level || "unknown";
              document.getElementById("security-score").textContent =
                securityScore;

              const levelBadge = document.getElementById("security-level");
              levelBadge.textContent = securityLevel.toUpperCase();

              // Badge color according to level
              levelBadge.className = "badge ";
              if (securityLevel === "excellent")
                levelBadge.className += "bg-success";
              else if (securityLevel === "good")
                levelBadge.className += "bg-primary";
              else if (securityLevel === "moderate")
                levelBadge.className += "bg-warning";
              else levelBadge.className += "bg-danger";

              // Trend
              const trend = insights.summary.trend || "stable";
              const changePercent = insights.summary.change_percent || 0;
              document.getElementById("trend-direction").textContent =
                trend === "increasing"
                  ? "📈 Increasing"
                  : trend === "decreasing"
                  ? "📉 Decreasing"
                  : "➡️ Stable";
              document.getElementById("trend-details").textContent = `${
                changePercent > 0 ? "+" : ""
              }${changePercent.toFixed(1)}% vs yesterday`;

              // Suspicious objects
              document.getElementById("suspicious-count").textContent =
                insights.summary.suspicious_count || 0;

              // Top objects
              const topObjects = insights.top_objects || [];
              let topObjectsHtml = "";
              if (topObjects.length === 0) {
                topObjectsHtml =
                  '<p class="text-muted">No detections today</p>';
              } else {
                topObjects.forEach((obj, index) => {
                  topObjectsHtml += `
                  <div class="d-flex align-items-center mb-2 pb-2 border-bottom">
                    <span class="badge bg-primary me-2">${index + 1}</span>
                    <div class="flex-grow-1">
                      <strong>${obj.object_type}</strong>
                      <div class="progress" style="height: 5px;">
                        <div class="progress-bar bg-success" style="width: ${
                          obj.avg_confidence
                        }%"></div>
                      </div>
                    </div>
                    <span class="badge bg-light text-dark ms-2">${
                      obj.count
                    }</span>
                  </div>
                `;
                });
              }
              document.getElementById("top-objects-list").innerHTML =
                topObjectsHtml;

              // AI Recommendation
              const topRec = insights.top_recommendation;
              let recHtml = "";
              if (!topRec) {
                recHtml =
                  '<p class="text-muted">No recommendations at the moment</p>';
              } else {
                const priorityColor =
                  topRec.priority === "high"
                    ? "danger"
                    : topRec.priority === "medium"
                    ? "warning"
                    : "info";

                recHtml = `
                <div class="alert alert-${priorityColor} mb-0">
                  <h6 class="alert-heading"><i class="bi bi-lightbulb-fill me-2"></i>${
                    topRec.title
                  }</h6>
                  <ul class="mb-0">
                    ${topRec.actions
                      .slice(0, 3)
                      .map((action) => `<li>${action}</li>`)
                      .join("")}
                  </ul>
                  <div class="mt-2">
                    <a href="/analytics/ai-report/" class="btn btn-sm btn-outline-${priorityColor}">
                      View all recommendations →
                    </a>
                  </div>
                </div>
              `;
              }
              document.getElementById("ai-recommendation").innerHTML = recHtml;
            } else {
              showDefaultInsights();
            }
          } else {
            showDefaultInsights();
          }
        } catch (error) {
          console.log("Error loading AI insights:", error);
          showDefaultInsights();
        }
      }

      function showDefaultInsights() {
        // Display default values in case of error
        document.getElementById("security-score").textContent = "--";
        document.getElementById("security-level").textContent = "N/A";
        document.getElementById("trend-direction").textContent = "--";
        document.getElementById("trend-details").textContent =
          "Insufficient data";
        document.getElementById("suspicious-count").textContent = "0";
        document.getElementById("top-objects-list").innerHTML =
          '<p class="text-muted">Perform detections to view statistics</p>';
        document.getElementById("ai-recommendation").innerHTML =
          '<p class="text-muted">AI recommendations will appear after your first detections</p>';
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>

