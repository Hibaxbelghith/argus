<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARGUS - Change Password</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background effects */
    body::before,
    body::after {
      content: '';
      position: fixed;
      opacity: 0.12;
      pointer-events: none;
    }

    body::before {
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, transparent, #0066ff, transparent);
      top: 20%;
      left: 0;
      animation: scan 8s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(0, 102, 255, 0.5);
    }

    body::after {
      width: 500px;
      height: 500px;
      border: 2px solid #0066ff;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: radar 10s linear infinite;
    }

    @keyframes scan {
      0%, 100% { top: 10%; opacity: 0; }
      50% { top: 80%; opacity: 0.12; }
    }

    @keyframes radar {
      0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0.15; }
      50% { opacity: 0.08; }
      100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
    }

    /* Container */
    .password-container {
      width: 100%;
      max-width: 520px;
      position: relative;
      z-index: 1;
    }

    /* Card */
    .password-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    /* Header */
    .password-header {
      text-align: center;
      margin-bottom: 36px;
    }

    .logo-wrapper {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #0066ff, #0099ff);
      border-radius: 14px;
      margin-bottom: 16px;
      font-size: 28px;
    }

    .password-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 6px;
    }

    .password-header p {
      color: #6b7280;
      font-size: 14px;
    }

    /* Alert */
    .alert-custom {
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      margin-bottom: 24px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      border: 1.5px solid rgba(16, 185, 129, 0.3);
      color: #059669;
    }

    .alert-danger {
      background: rgba(239, 68, 68, 0.1);
      border: 1.5px solid rgba(239, 68, 68, 0.3);
      color: #dc2626;
    }

    .alert-warning {
      background: rgba(251, 191, 36, 0.1);
      border: 1.5px solid rgba(251, 191, 36, 0.3);
      color: #d97706;
    }

    /* Security Tips */
    .security-tips {
      background: rgba(99, 102, 241, 0.05);
      border: 1.5px solid rgba(99, 102, 241, 0.15);
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 28px;
    }

    .security-tips-title {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #4f46e5;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .security-tips-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .security-tips-list li {
      color: #374151;
      font-size: 13px;
      line-height: 1.8;
      padding-left: 20px;
      position: relative;
      margin-bottom: 6px;
    }

    .security-tips-list li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #4f46e5;
      font-weight: bold;
    }

    /* Form Groups */
    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      color: #374151;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .input-wrapper {
      position: relative;
    }

    input[type="password"] {
      width: 100%;
      padding: 12px 46px 12px 16px;
      background: #f9fafb;
      border: 1.5px solid #e5e7eb;
      border-radius: 10px;
      color: #1a1a1a;
      font-size: 15px;
      transition: all 0.2s ease;
      outline: none;
    }

    input[type="password"]:focus {
      background: #ffffff;
      border-color: #0066ff;
      box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
    }

    input::placeholder {
      color: #9ca3af;
    }

    /* Toggle password visibility */
    .toggle-password {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 18px;
      padding: 4px;
      transition: color 0.2s ease;
    }

    .toggle-password:hover {
      color: #0066ff;
    }

    /* Password strength indicator */
    .password-strength {
      margin-top: 8px;
      display: none;
    }

    .password-strength.active {
      display: block;
    }

    .strength-bar {
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 6px;
    }

    .strength-bar-fill {
      height: 100%;
      transition: all 0.3s ease;
      border-radius: 3px;
    }

    .strength-text {
      font-size: 12px;
      font-weight: 600;
    }

    .strength-weak .strength-bar-fill {
      width: 33%;
      background: linear-gradient(90deg, #ef4444, #dc2626);
    }

    .strength-weak .strength-text {
      color: #dc2626;
    }

    .strength-medium .strength-bar-fill {
      width: 66%;
      background: linear-gradient(90deg, #f59e0b, #d97706);
    }

    .strength-medium .strength-text {
      color: #d97706;
    }

    .strength-strong .strength-bar-fill {
      width: 100%;
      background: linear-gradient(90deg, #10b981, #059669);
    }

    .strength-strong .strength-text {
      color: #059669;
    }

    /* Help text */
    .help-text {
      font-size: 12px;
      color: #6b7280;
      margin-top: 6px;
    }

    /* Error messages */
    .error-message {
      color: #dc2626;
      font-size: 12px;
      margin-top: 6px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    /* Buttons */
    .btn-primary-custom {
      width: 100%;
      padding: 13px;
      background: linear-gradient(135deg, #0066ff, #0099ff);
      border: none;
      border-radius: 10px;
      color: #ffffff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    .btn-primary-custom:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    }

    .btn-primary-custom:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Secondary Actions */
    .secondary-actions {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-secondary-custom {
      flex: 1;
      min-width: 180px;
      padding: 11px 20px;
      background: #ffffff;
      border: 1.5px solid #e5e7eb;
      border-radius: 10px;
      color: #374151;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-secondary-custom:hover {
      background: #f9fafb;
      border-color: #0066ff;
      color: #0066ff;
      transform: translateY(-1px);
    }

    /* Responsive */
    @media (max-width: 640px) {
      .password-card {
        padding: 28px 24px;
      }

      .security-tips {
        padding: 14px;
      }

      .secondary-actions {
        flex-direction: column;
      }

      .btn-secondary-custom {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="password-container">
    <div class="password-card">
      <!-- Header -->
      <div class="password-header">
        <div class="logo-wrapper">üîí</div>
        <h1>Change Password</h1>
        <p>Keep your account secure with a strong password</p>
      </div>

      <!-- Alerts -->
      {% if messages %}
        {% for message in messages %}
          <div class="alert-custom alert-{{ message.tags }}">
            <span>
              {% if message.tags == 'success' %}‚úÖ
              {% elif message.tags == 'danger' or message.tags == 'error' %}‚ùå
              {% else %}‚ö†Ô∏è{% endif %}
            </span>
            <span>{{ message }}</span>
          </div>
        {% endfor %}
      {% endif %}

      <!-- Security Tips -->
      <div class="security-tips">
        <div class="security-tips-title">
          <span>üõ°Ô∏è</span>
          <span>Password Security Tips</span>
        </div>
        <ul class="security-tips-list">
          <li>Use at least 8 characters with mixed case letters</li>
          <li>Include numbers and special characters</li>
          <li>Avoid common words or personal information</li>
          <li>Don't reuse passwords from other accounts</li>
        </ul>
      </div>

      <!-- Form -->
      <form method="POST" id="passwordForm">
        {% csrf_token %}

        <!-- Old Password -->
        <div class="form-group">
          <label for="id_old_password">Current Password</label>
          <div class="input-wrapper">
            <input type="password" name="old_password" id="id_old_password" placeholder="Enter current password" required>
            <button type="button" class="toggle-password" data-target="id_old_password">üëÅÔ∏è</button>
          </div>
        </div>

        <!-- New Password -->
        <div class="form-group">
          <label for="id_new_password1">New Password</label>
          <div class="input-wrapper">
            <input type="password" name="new_password1" id="id_new_password1" placeholder="Enter new password" required>
            <button type="button" class="toggle-password" data-target="id_new_password1">üëÅÔ∏è</button>
          </div>
          <div class="password-strength" id="strengthIndicator">
            <div class="strength-bar">
              <div class="strength-bar-fill"></div>
            </div>
            <div class="strength-text"></div>
          </div>
          <div class="help-text">Minimum 8 characters with uppercase, lowercase, numbers, and symbols</div>
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label for="id_new_password2">Confirm New Password</label>
          <div class="input-wrapper">
            <input type="password" name="new_password2" id="id_new_password2" placeholder="Confirm new password" required>
            <button type="button" class="toggle-password" data-target="id_new_password2">üëÅÔ∏è</button>
          </div>
          <div class="error-message" id="matchError">Passwords do not match</div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn-primary-custom" id="submitBtn">
          üîê Update Password
        </button>
      </form>

      <!-- Secondary Actions -->
      <div class="secondary-actions">
        <a href="{% url 'profile' %}" class="btn-secondary-custom">
          ‚Üê Back to Profile
        </a>
        <a href="{% url 'dashboard' %}" class="btn-secondary-custom">
          üè† Dashboard
        </a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const input = document.getElementById(targetId);
        
        if (input.type === 'password') {
          input.type = 'text';
          this.textContent = 'üôà';
        } else {
          input.type = 'password';
          this.textContent = 'üëÅÔ∏è';
        }
      });
    });

    // Password strength checker
    const newPassword = document.getElementById('id_new_password1');
    const strengthIndicator = document.getElementById('strengthIndicator');
    const submitBtn = document.getElementById('submitBtn');

    function checkPasswordStrength(password) {
      let strength = 0;
      
      if (password.length >= 8) strength++;
      if (password.length >= 12) strength++;
      if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
      if (/[0-9]/.test(password)) strength++;
      if (/[^a-zA-Z0-9]/.test(password)) strength++;

      return strength;
    }

    newPassword.addEventListener('input', function() {
      const password = this.value;
      const strength = checkPasswordStrength(password);

      if (password.length === 0) {
        strengthIndicator.classList.remove('active');
        return;
      }

      strengthIndicator.classList.add('active');
      strengthIndicator.classList.remove('strength-weak', 'strength-medium', 'strength-strong');

      if (strength <= 2) {
        strengthIndicator.classList.add('strength-weak');
        strengthIndicator.querySelector('.strength-text').textContent = '‚ùå Weak password';
      } else if (strength <= 3) {
        strengthIndicator.classList.add('strength-medium');
        strengthIndicator.querySelector('.strength-text').textContent = '‚ö†Ô∏è Medium strength';
      } else {
        strengthIndicator.classList.add('strength-strong');
        strengthIndicator.querySelector('.strength-text').textContent = '‚úÖ Strong password';
      }
    });

    // Password match validation
    const confirmPassword = document.getElementById('id_new_password2');
    const matchError = document.getElementById('matchError');

    function validatePasswordMatch() {
      if (confirmPassword.value.length === 0) {
        matchError.classList.remove('show');
        return true;
      }

      if (newPassword.value !== confirmPassword.value) {
        matchError.classList.add('show');
        return false;
      } else {
        matchError.classList.remove('show');
        return true;
      }
    }

    confirmPassword.addEventListener('input', validatePasswordMatch);
    newPassword.addEventListener('input', validatePasswordMatch);

    // Form validation
    const form = document.getElementById('passwordForm');
    form.addEventListener('submit', function(e) {
      const oldPassword = document.getElementById('id_old_password').value;
      const newPass1 = newPassword.value;
      const newPass2 = confirmPassword.value;

      // Check if all fields are filled
      if (!oldPassword || !newPass1 || !newPass2) {
        e.preventDefault();
        alert('‚ùå Please fill in all fields');
        return;
      }

      // Check password length
      if (newPass1.length < 8) {
        e.preventDefault();
        alert('‚ùå New password must be at least 8 characters long');
        return;
      }

      // Check password match
      if (newPass1 !== newPass2) {
        e.preventDefault();
        alert('‚ùå New passwords do not match');
        return;
      }

      // Check if new password is different from old
      if (oldPassword === newPass1) {
        e.preventDefault();
        alert('‚ùå New password must be different from current password');
        return;
      }

      // Disable submit button to prevent double submission
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Updating...';
    });
  </script>
</body>
</html>